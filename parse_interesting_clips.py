from openai import OpenAI
from anthropic import Anthropic
import json
import os
client = Anthropic()

def ask_gpt(final_prompt, output_path):
    initial_prompt = f"""Greetings. You are a timestamp parser aimed to produce a list of start and end times in valid JSON. 
    Your responses should contain nothing other than valid JSON. Be straight to the point, without any superfluous text. 
    You will be provided with a list of objects representing transcribed audio snippets that contain start and end times, and an associated text transcription.
    Your task is to connect these transcribed snippets together and return a list of start and end times that encapsulate an interesting and complete thought.
    Interesting thoughts should make sense out of context, meaning they start and end in a way that is coherent, complete, and natural.
    These connected transcriptions that you will provide will be used to create inspirational, calming, and philosophical TikTok videos.
    The difference between the start and end times of each connected transcription should be at least 100, meaning the connected transcription would be at least 100 seconds long.
    Your output should contain only JSON, and should be in the following format:
    {{
        "timestamps": [
            {{
                "start": 0.0,
                "end": 100.0
            }},
            {{
                "start": 10.0,
                "end": 200.0
            }}
        ]
    }}
    """

    prompt_question1 = """[{"timestamp": [0.0, 11.56], "text": " Now then, we have to get on to Buddhism. And in order to introduce Buddhism, it's necessary to"}, {"timestamp": [11.56, 21.18], "text": " remember the whole background of the world view of India. In other words, what we're going to study"}, {"timestamp": [21.18, 25.0], "text": " first of all to understand Buddhism is Indian cosmology,"}, {"timestamp": [25.0, 32.0], "text": " just as you would have to study the cosmology of the Ptolemaic view of the world in order to understand Dante,"}, {"timestamp": [32.0, 36.0], "text": " and in order to understand lots of things about medieval Christianity."}, {"timestamp": [37.0, 47.14], "text": " So the cosmology of the Hindus, their view of the universe, has come right into Japanese life through Buddhism, but it"}, {"timestamp": [47.14, 48.2], "text": " antedates Buddhism."}, {"timestamp": [49.14, 53.4], "text": " Buddhism simply adopted it as a matter of course, just as now if you invented a new"}, {"timestamp": [53.4, 56.78], "text": " religion, you would probably adopt the cosmology of modern astronomy."}, {"timestamp": [58.8, 61.52], "text": " Well now, how does the Hindu see the world?"}, {"timestamp": [62.32, 71.58], "text": " You know, there are really three great views of the world that human beings have had and they go one is is the Western view of"}, {"timestamp": [71.58, 79.0], "text": " the world which looks upon the world as a construct, an artifact by analogy with"}, {"timestamp": [79.0, 88.38], "text": " ceramics and carpentry. Then there is the Hindu view of the world which is dramatic, looks on it"}, {"timestamp": [88.38, 94.92], "text": " as a play. And then the Chinese view which is organic and looks upon the world as an"}, {"timestamp": [94.92, 105.94], "text": " organism, a body. But the Hindu view sees it as a drama. And it's simply this. There is what there is,"}, {"timestamp": [106.42, 108.12], "text": " and always was and always will be,"}, {"timestamp": [108.18, 109.18], "text": " which is called the self."}, {"timestamp": [110.7, 113.4], "text": " That in Sanskrit is Atman, A-T-M-A-N."}, {"timestamp": [114.7, 116.7], "text": " And the Atman is also called Brahman."}, {"timestamp": [117.36, 119.16], "text": " Brahman, from the root Bri,"}, {"timestamp": [119.16, 122.62], "text": " to grow, to expand, to swell,"}, {"timestamp": [137.88, 145.9], "text": " is actually related to our word breath. So Brahman, the self, according to the Hindu view, plays hide-and-seek with itself for always and always and always."}, {"timestamp": [147.28, 149.68], "text": " How far out, how lost can you get?"}, {"timestamp": [151.58, 154.76], "text": " So here each one of us, according to the Hindu idea,"}, {"timestamp": [155.24, 161.1], "text": " is the Godhead on purpose getting lost for the fun of it."}, {"timestamp": [162.8, 164.98], "text": " And how terrible it can get at times."}, {"timestamp": [164.98, 165.0], "text": " But won't it be nice when you wake up? for the fun of it. And how terrible it can get at times."}, {"timestamp": [165.36, 166.86], "text": " But won't it be nice when you wake up?"}, {"timestamp": [168.88, 170.46], "text": " That's sort of the basic idea."}, {"timestamp": [170.84, 173.4], "text": " And I found it's an idea that any child can understand."}, {"timestamp": [173.54, 175.44], "text": " It has great simplicity and great elegance."}, {"timestamp": [178.4, 180.44], "text": " Now, in part of this cosmology,"}, {"timestamp": [180.58, 184.5], "text": " we must understand another feature of this conception of the universe."}, {"timestamp": [185.88, 189.32], "text": " Not only, you remember now, the kalpas, the periods of time,"}, {"timestamp": [189.62, 193.4], "text": " the yugas, the qualities of the time through which the universe goes,"}, {"timestamp": [193.48, 196.72], "text": " but there's the final thing, which are called the six worlds,"}, {"timestamp": [197.66, 199.28], "text": " or the six paths of life."}, {"timestamp": [201.36, 205.24], "text": " And this is very important for Buddhism Buddhism although it comes from Hinduism"}, {"timestamp": [205.24, 208.34], "text": " is represented in what is called the bhava chakra"}, {"timestamp": [208.34, 212.08], "text": " bhava means becoming b-h-a-v-a"}, {"timestamp": [212.08, 215.56], "text": " chakra c-h-a-k-r-a means wheel"}, {"timestamp": [215.56, 219.44], "text": " the wheel of becoming the wheel of birth and death"}, {"timestamp": [219.44, 224.8], "text": " and it has six divisions it has the top people"}, {"timestamp": [224.8, 226.4], "text": " and the bottom people the top people and the bottom people."}, {"timestamp": [226.96, 230.7], "text": " The top people are called Deva, D-E-V-A."}, {"timestamp": [231.54, 236.4], "text": " The bottom people are called Naraka, N-A-R-A-K-A."}, {"timestamp": [237.08, 238.1], "text": " Devas are angels,"}, {"timestamp": [238.72, 242.38], "text": " and they are the people who are the supreme spiritual successors."}, {"timestamp": [243.36, 247.0], "text": " The Naraka are tormented in purgatory, and they are the supreme spiritual successes. The Naraka are tormented in purgatory and they are the"}, {"timestamp": [248.12, 255.12], "text": " supreme spiritual failures. They are the poles, the happiest people and the saddest people."}, {"timestamp": [258.5, 265.82], "text": " Then in between there comes the world of the Pretas next to the naraka, next to the purgatory."}, {"timestamp": [266.58, 271.82], "text": " The pretas are the frustrated spirits who have tiny mouths and enormous bellies."}, {"timestamp": [272.58, 276.64], "text": " Huge appetites, but very, very limited means of satisfying it."}, {"timestamp": [278.58, 282.62], "text": " Then next, they come between the narakas and the devas at the top."}, {"timestamp": [283.28, 285.76], "text": " Next up from the pretas are the human beings."}, {"timestamp": [287.6, 293.68], "text": " And they are supposed to hold a middle position in the six worlds. Then you go up from the human"}, {"timestamp": [293.68, 298.4], "text": " beings to the Devas and then you start coming down again. The next world is called the Asura."}, {"timestamp": [299.52, 307.08], "text": " And those are the wrathful spirits, the personifications of storm and all the anger and violence of"}]"""
    prompt_answer1= """{"timestamps":[{"start": 0.0, "end": 109.18)]}"""
    prompt_question2= """[{"timestamp": [110.7, 113.4], "text": " That in Sanskrit is Atman, A-T-M-A-N."}, {"timestamp": [114.7, 116.7], "text": " And the Atman is also called Brahman."}, {"timestamp": [117.36, 119.16], "text": " Brahman, from the root Bri,"}, {"timestamp": [119.16, 122.62], "text": " to grow, to expand, to swell,"}, {"timestamp": [137.88, 145.9], "text": " is actually related to our word breath. So Brahman, the self, according to the Hindu view, plays hide-and-seek with itself for always and always and always."}, {"timestamp": [147.28, 149.68], "text": " How far out, how lost can you get?"}, {"timestamp": [151.58, 154.76], "text": " So here each one of us, according to the Hindu idea,"}, {"timestamp": [155.24, 161.1], "text": " is the Godhead on purpose getting lost for the fun of it."}, {"timestamp": [162.8, 164.98], "text": " And how terrible it can get at times."}, {"timestamp": [164.98, 165.0], "text": " But won't it be nice when you wake up? for the fun of it. And how terrible it can get at times."}, {"timestamp": [165.36, 166.86], "text": " But won't it be nice when you wake up?"}, {"timestamp": [168.88, 170.46], "text": " That's sort of the basic idea."}, {"timestamp": [170.84, 173.4], "text": " And I found it's an idea that any child can understand."}, {"timestamp": [173.54, 175.44], "text": " It has great simplicity and great elegance."}, {"timestamp": [178.4, 180.44], "text": " Now, in part of this cosmology,"}, {"timestamp": [180.58, 184.5], "text": " we must understand another feature of this conception of the universe."}, {"timestamp": [185.88, 189.32], "text": " Not only, you remember now, the kalpas, the periods of time,"}, {"timestamp": [189.62, 193.4], "text": " the yugas, the qualities of the time through which the universe goes,"}, {"timestamp": [193.48, 196.72], "text": " but there's the final thing, which are called the six worlds,"}, {"timestamp": [197.66, 199.28], "text": " or the six paths of life."}, {"timestamp": [201.36, 205.24], "text": " And this is very important for Buddhism Buddhism although it comes from Hinduism"}, {"timestamp": [205.24, 208.34], "text": " is represented in what is called the bhava chakra"}, {"timestamp": [208.34, 212.08], "text": " bhava means becoming b-h-a-v-a"}, {"timestamp": [212.08, 215.56], "text": " chakra c-h-a-k-r-a means wheel"}, {"timestamp": [215.56, 219.44], "text": " the wheel of becoming the wheel of birth and death"}, {"timestamp": [219.44, 224.8], "text": " and it has six divisions it has the top people"}, {"timestamp": [224.8, 226.4], "text": " and the bottom people the top people and the bottom people."}, {"timestamp": [226.96, 230.7], "text": " The top people are called Deva, D-E-V-A."}, {"timestamp": [231.54, 236.4], "text": " The bottom people are called Naraka, N-A-R-A-K-A."}, {"timestamp": [237.08, 238.1], "text": " Devas are angels,"}, {"timestamp": [238.72, 242.38], "text": " and they are the people who are the supreme spiritual successors."}, {"timestamp": [243.36, 247.0], "text": " The Naraka are tormented in purgatory, and they are the supreme spiritual successes. The Naraka are tormented in purgatory and they are the"}, {"timestamp": [248.12, 255.12], "text": " supreme spiritual failures. They are the poles, the happiest people and the saddest people."}, {"timestamp": [258.5, 265.82], "text": " Then in between there comes the world of the Pretas next to the naraka, next to the purgatory."}, {"timestamp": [266.58, 271.82], "text": " The pretas are the frustrated spirits who have tiny mouths and enormous bellies."}, {"timestamp": [272.58, 276.64], "text": " Huge appetites, but very, very limited means of satisfying it."}, {"timestamp": [278.58, 282.62], "text": " Then next, they come between the narakas and the devas at the top."}, {"timestamp": [283.28, 285.76], "text": " Next up from the pretas are the human beings."}, {"timestamp": [287.6, 293.68], "text": " And they are supposed to hold a middle position in the six worlds. Then you go up from the human"}, {"timestamp": [293.68, 298.4], "text": " beings to the Devas and then you start coming down again. The next world is called the Asura."}, {"timestamp": [299.52, 307.08], "text": " And those are the wrathful spirits, the personifications of storm and all the anger and violence of"}, {"timestamp": [307.08, 310.48], "text": " nature."}, {"timestamp": [310.48, 317.68], "text": " Next down is animals, coming between the Asura and the purgatories again."}, {"timestamp": [317.68, 321.8], "text": " Now all these needn't be taken literally, they are different modalities of the human"}, {"timestamp": [321.8, 323.92], "text": " mind."}, {"timestamp": [323.92, 325.46], "text": " We are in the Naraka world when we"}, {"timestamp": [325.46, 330.26], "text": " are frustrated and in torment. When we are merely chronically frustrated we are"}, {"timestamp": [330.26, 336.24], "text": " in the Preta world. When we are in a state of equanimity, even-mindedness, we"}, {"timestamp": [336.24, 341.0], "text": " are in the human world. When we are deliriously happy we are in the Deva"}, {"timestamp": [341.0, 347.16], "text": " world. When we are furious we are in the Asura world. When we are furious, we are in the ashura world. And when we are dumb, we are in the animal world."}, {"timestamp": [350.16, 351.98], "text": " So these are all modalities."}]"""
    prompt_answer2= """{"timestamps":[{"start":110.7, "end":170.46), {"start":147.28, "end":199.28}]}"""
    prompt_question3= """{"timestamp": [353.4, 354.66], "text": " And it would be said now,"}, {"timestamp": [355.96, 358.58], "text": " this is terribly important to understand Buddhism."}, {"timestamp": [360.5, 362.04], "text": " Because the better you get,"}, {"timestamp": [362.16, 363.9], "text": " the more you go up to the deva world."}, {"timestamp": [364.26, 367.4], "text": " The worse you get, the more you go up to the deva world, the worse you get, the more you go down to the naraka world."}, {"timestamp": [367.76, 370.1], "text": " But everything that goes up has to come down."}, {"timestamp": [372.52, 376.0], "text": " So you can't improve yourself indefinitely."}, {"timestamp": [377.48, 380.04], "text": " If you improve yourself beyond a certain limit,"}, {"timestamp": [380.34, 381.8], "text": " you simply start to get worse."}, {"timestamp": [381.8, 385.34], "text": " Like when you make a knife too sharp, it begins to wear away."}, {"timestamp": [388.74, 391.66], "text": " So the Buddhahood or liberation,"}, {"timestamp": [392.56, 395.66], "text": " enlightenment, is on no place on the wheel,"}, {"timestamp": [397.42, 399.18], "text": " unless it might be the center."}, {"timestamp": [401.54, 403.8], "text": " By ascending, by becoming better,"}, {"timestamp": [404.88, 409.04], "text": " you tie yourself to the wheel by gold chains."}, {"timestamp": [409.04, 415.44], "text": " By retrogressing and becoming worse, you tie yourself to the wheel with iron chains."}, {"timestamp": [415.44, 422.02], "text": " But the Buddha is one who gets rid of the chains altogether."}, {"timestamp": [422.02, 427.1], "text": " And so this will explain why Buddhism unlike Judaism and unlike Christianity"}, {"timestamp": [427.1, 434.62], "text": " is not very very frantically concerned with being good it is concerned with"}, {"timestamp": [434.62, 441.6], "text": " being wise it is concerned with being compassionate is a little different from"}, {"timestamp": [441.6, 448.04], "text": " being good with having tremendous sympathy and understanding and respect"}, {"timestamp": [448.04, 452.3], "text": " for all the ignorant people who don't know that they're it,"}, {"timestamp": [453.06, 457.06], "text": " but who are playing the very far-out game of being you and I."}, {"timestamp": [458.86, 463.1], "text": " And so this is why every Hindu greets his brother"}, {"timestamp": [463.1, 465.32], "text": " not by shaking hands hands but by putting his"}, {"timestamp": [465.32, 470.94], "text": " hands together and bowing this is why the Japanese bow to each other basically"}, {"timestamp": [470.94, 476.08], "text": " this is why Buddhist rituals are full of the bowing gesture because you are"}, {"timestamp": [476.08, 481.0], "text": " honoring the self playing the roles of all the people around you and all the"}, {"timestamp": [481.0, 489.32], "text": " more honor is due when the self has forgotten what it's doing and is therefore in a very far out situation"}, {"timestamp": [489.32, 495.68], "text": " now that is the basic Hindu view of the world"}, {"timestamp": [495.68, 499.8], "text": " that's the cosmology which goes along with Buddhism"}, {"timestamp": [499.8, 509.0], "text": " according to taste, temperament, tradition, popular belief and so on,"}, {"timestamp": [509.02, 510.6], "text": " there is this additional idea"}, {"timestamp": [510.6, 520.02], "text": " that when the Lord, the Self, pretends that it's each of us,"}, {"timestamp": [520.02, 524.92], "text": " it first of all pretends that it is something called the Jivatman."}, {"timestamp": [524.92, 525.98], "text": " it first of all pretends that it is something called the Jivatman."}, {"timestamp": [532.3, 533.46], "text": " The Atman, the self, pretends to be an individual soul called a Jivatman."}, {"timestamp": [537.38, 538.6], "text": " And the Jivatman reincarnates through a whole series of bodies,"}, {"timestamp": [540.18, 542.84], "text": " life after life after life."}, {"timestamp": [554.46, 570.2], "text": " And according to what is called karma karma literally means doing the law of doing whereby acts occur in a series and they are linked with each other in an unbreakable chain."}, {"timestamp": [570.2, 576.76], "text": " So everybody's karma is the life course that he will work out through maybe innumerable"}, {"timestamp": [576.76, 579.76], "text": " lifetimes."}, {"timestamp": [579.76, 584.24], "text": " I'm not going into that because a lot of Buddhists don't believe that."}, {"timestamp": [584.24, 585.6], "text": " You will find that the Zen people,"}, {"timestamp": [585.6, 591.52], "text": " for example, are quite divided on this. They will say, no, we don't believe literally in reincarnation."}, {"timestamp": [592.64, 598.72], "text": " That after your funeral, you know, you will suddenly become somebody different living"}, {"timestamp": [598.72, 607.24], "text": " somewhere else. They will say reincarnation means this, that if you sitting here now are really convinced"}, {"timestamp": [607.24, 611.64], "text": " that you're the same person who walked in at the door half an hour ago, you're being"}, {"timestamp": [611.64, 613.9], "text": " reincarnated."}, {"timestamp": [613.9, 617.76], "text": " If you're liberated, you'll understand that you're not."},"""
    prompt_answer3="""{"timestamps":[{"start":353.4, "end":415.44},{"start":422.02, "end":509.0},{"start":509.02, "end":617.76}]}"""
    prompt_question4 = """
        {"timestamp": [617.76, 620.86], "text": " The past doesn't exist."}, 
        {"timestamp": [620.86, 622.86], "text": " The future doesn't exist."}, 
        {"timestamp": [622.86, 624.24], "text": " There is only the present."},
        {"timestamp": [624.24, 627.0], "text": " And that's the only real you that there is."}, 
        {"timestamp": [627.0, 631.0], "text": " The Zen master Dogen put it in this way. He said,"}, 
        {"timestamp": [631.0, 635.0], "text": " Spring does not become the summer."}, 
        {"timestamp": [635.0, 638.0], "text": " First there is summer, and then there is spring."}, 
        {"timestamp": [638.0, 641.0], "text": " Each season stays in its own place."}, 
        {"timestamp": [641.0, 645.84], "text": " And so in the same way the you of yesterday does not become the you of today"}, 
        {"timestamp": [650.4, 656.4], "text": " t.s elliott has the same idea in his poem the four quartets where he says uh when you settle"}, 
        {"timestamp": [656.4, 662.96], "text": " down in the train to read your newspaper and uh so on you are not the same person who a little"}, 
        {"timestamp": [662.96, 665.6], "text": " while ago left the platform if you think you are you are linking your same person who a little while ago left the platform."}, 
        {"timestamp": [669.6, 670.8], "text": " If you think you are, you are linking your moments up in a chain."}, 
        {"timestamp": [674.64, 676.42], "text": " And this is what binds you to the wheel of birth and death."}, 
        {"timestamp": [680.26, 681.28], "text": " But when you know that every moment at which you are is the only moment,"}, 
        {"timestamp": [682.34, 682.44], "text": " this comes into Zen."}, 
        {"timestamp": [683.94, 684.36], "text": " A master will say to somebody,"}, 
        {"timestamp": [685.46, 693.76], "text": " get up and walk across the room. And he comes back and he says, where are your footprints? They've gone. So where"}, 
        {"timestamp": [693.76, 699.6], "text": " are you? Who are you? When we are asked who we are, we usually give a kind of recitation"}, 
        {"timestamp": [699.6, 704.28], "text": " of a history. Well, I'm so-and-so. I was given this name by my parents. I've been to such"}, 
        {"timestamp": [704.28, 709.24], "text": " and such a college. I've done these things in my profession, and I produce a little biography."}, 
        {"timestamp": [709.24, 716.24], "text": " Buddhist says forget it. That's not you. That's some story. That's all gone, that's all past."}, 
        {"timestamp": [716.78, 725.94], "text": " I want to see the real you, you are now. Well, nobody knows who that is, you see, because we don't know ourselves"}, 
        {"timestamp": [725.94, 728.16], "text": " except through listening to our echoes"}, 
        {"timestamp": [728.16, 731.28], "text": " and consulting our memories."}, 
        {"timestamp": [732.04, 733.44], "text": " But then there's a real you,"}"""
    prompt_answer4 = """{"timestamps": [{"start": 617.76, "end": 645.84"), {"start": 650.4, "end": 731.28}]}"""
    
    response = client.messages.create(
        model="claude-3-opus-20240229",
        system=initial_prompt,
        messages=[
            {"role": "user", "content": final_prompt}
        ],
        max_tokens=1000
    )

    if os.path.exists(output_path):
        with open(output_path, "r") as f:
            data = json.load(f)
    else:
        data = []

    print(response.content[0].text)
    data += json.loads(response.content[0].text)["timestamps"]
    with open(output_path, "w") as f:
        f.write(json.dumps(data))
    